<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics and Reports - BizBot Admin</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- Include Chart.js -->
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <h2>BizBot Admin</h2>
            <nav>
                <ul>
                    <li><a href="dashboard.html">Dashboard</a></li>
                    <li><a href="chatbot-management.html">Chatbot Management</a></li>
                    <li><a href="training.html">Training Data</a></li>
                    <li><a href="integration.html">Integration</a></li>
                    <li><a href="settings.html">Settings</a></li>
                    <li><a href="analytics.html" class="active">Analytics</a></li>
                    <li><a href="support.html">Support</a></li>
                    <li><button class="btn-logout" onclick="logout()">Logout</button></li>
                </ul>
            </nav>
        </aside>
        <main class="main-content">
            <header class="dashboard-header">
                <h1>Analytics and Reports</h1>
            </header>

            <!-- Dropdown to choose a chatbot -->
            <div class="card">
                <h2>Choose a Chatbot</h2>
                <select id="chatbotSelector">
                    <!-- Options will be populated dynamically -->
                </select>
            </div>

            <!-- Dropdown to choose chart type -->
            <div class="card">
                <h2>Choose a Chart</h2>
                <select id="chartSelector">
                    <option value="bar">Bar Chart</option>
                    <option value="line">Line Chart</option>
                    <option value="pie">Pie Chart</option>
                </select>
            </div>

            <!-- Bar Chart Section -->
            <div class="card" id="barChartContainer" style="display: block;">
                <h2>Chatbot Rating (Bar Chart)</h2>
                <canvas id="barChart"></canvas>
            </div>

            <!-- Line Chart Section -->
            <div class="card" id="lineChartContainer" style="display: none;">
                <h2>Chatbot Rating (Line Chart)</h2>
                <canvas id="lineChart"></canvas>
            </div>

            <!-- Pie Chart Section -->
            <div class="card" id="pieChartContainer" style="display: none;">
                <h2>Chatbot Rating (Pie Chart)</h2>
                <div class="chart-container">
                <canvas id="pieChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h2>Interaction Logs</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Timestamp</th>
                            <th>Chatbot</th>
                            <th>User Query</th>
                            <th>Chatbot Response</th>
                        </tr>
                    </thead>
                    <tbody>
                        <!-- Table data here -->
                    </tbody>
                </table>
            </div>
        </main>
    </div>

    <!-- Chart.js Initialization Script -->
    <script>
        const ctxBar = document.getElementById('barChart').getContext('2d');
        const ctxLine = document.getElementById('lineChart').getContext('2d');
        const ctxPie = document.getElementById('pieChart').getContext('2d');

        let barChart, lineChart, pieChart;
        
        // Fetch chatbot ratings data
        async function fetchChatbotRatings(chatbotId) {
            const response = await fetch(`/api/chatbot/ratings/${chatbotId}`);  // Replace with actual API endpoint
            const data = await response.json();
            return data.ratings;
        }

        // Populate the chatbot dropdown dynamically
        async function loadChatbotSelector() {
            const response = await fetch('/api/chatbots');  // Replace with actual API endpoint
            const chatbots = await response.json();

            const chatbotSelector = document.getElementById('chatbotSelector');
            chatbots.forEach(chatbot => {
                const option = document.createElement('option');
                option.value = chatbot.id;
                option.textContent = chatbot.name;
                chatbotSelector.appendChild(option);
            });

            // Default selection
            const selectedChatbotId = chatbots[0].id;
            loadCharts(selectedChatbotId);
        }

        // Update charts with new data
        async function loadCharts(chatbotId) {
            const ratings = await fetchChatbotRatings(chatbotId);

            // Bar Chart
            if (barChart) barChart.destroy();
            barChart = new Chart(ctxBar, {
                type: 'bar',
                data: {
                    labels: ['January', 'February', 'March', 'April', 'May'],
                    datasets: [{
                        label: 'Chatbot Ratings',
                        data: ratings.bar,
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });

            // Line Chart
            if (lineChart) lineChart.destroy();
            lineChart = new Chart(ctxLine, {
                type: 'line',
                data: {
                    labels: ['January', 'February', 'March', 'April', 'May'],
                    datasets: [{
                        label: 'Chatbot Rating Over Time',
                        data: ratings.line,
                        fill: false,
                        borderColor: 'rgba(54, 162, 235, 1)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true
                }
            });

            // Pie Chart
            if (pieChart) pieChart.destroy();
            pieChart = new Chart(ctxPie, {
                type: 'pie',
                data: {
                    labels: ['Positive', 'Neutral', 'Negative'],
                    datasets: [{
                        label: 'Chatbot Rating Distribution',
                        data: ratings.pie,
                        backgroundColor: ['rgba(255, 99, 132, 0.2)', 'rgba(54, 162, 235, 0.2)', 'rgba(255, 206, 86, 0.2)'],
                        borderColor: ['rgba(255, 99, 132, 1)', 'rgba(54, 162, 235, 1)', 'rgba(255, 206, 86, 1)'],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true
                }
            });
        }

        // Dropdown selection logic
        document.getElementById('chartSelector').addEventListener('change', function() {
            const selectedChart = this.value;
            document.getElementById('barChartContainer').style.display = selectedChart === 'bar' ? 'block' : 'none';
            document.getElementById('lineChartContainer').style.display = selectedChart === 'line' ? 'block' : 'none';
            document.getElementById('pieChartContainer').style.display = selectedChart === 'pie' ? 'block' : 'none';
        });

        // On chatbot selection change
        document.getElementById('chatbotSelector').addEventListener('change', function() {
            const selectedChatbotId = this.value;
            loadCharts(selectedChatbotId);
        });

        // Initialize the page by loading chatbot selector and charts
        loadChatbotSelector();
    </script>
</body>
</html>
